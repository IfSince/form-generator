<div class="flex-layout-container supporting-pane">
  <form class="supporting-pane__main flex-layout-container flex-layout-container__column"
        [formGroup]="_formGroup"
        (ngSubmit)="onSubmit(false)">
    <mat-card>
      <mat-card-header class="btn-group btn-group__between">
        <mat-card-title>Preview Form</mat-card-title>
        <mat-card-subtitle>Select a form field to edit</mat-card-subtitle>

        <div class="test">
          <mat-form-field [subscriptSizing]="'dynamic'">
            <mat-label>Material Component</mat-label>
            <mat-select [formControl]="breakpointControl">
              @for (breakpoint of Breakpoints; track breakpoint.name) {
                <mat-option [value]="breakpoint.width">{{ breakpoint.name }} ({{ breakpoint.width }})</mat-option>
              }

            </mat-select>
          </mat-form-field>

          <button mat-stroked-button type="button" (click)="addField()">
            <mat-icon>add</mat-icon>
            Add field
          </button>
        </div>
      </mat-card-header>
    </mat-card>

    <mat-card class="content">
      <mat-card-content class="scrollable-container">
          <div class="form-container flex-layout-container flex-layout-container__wrap"
               [ngStyle]="{ 'width': breakpointControl.value }">
            @for (field of flattenedFields(); track $index) {
              @if (![FieldType.INTERFACE, FieldType.OBJECT, FieldType.CLASS].includes(field.controls.fieldType.value)) {
                <app-selectable-form-field [selected]="selectedField() === field"
                                           (select)="selectedField.set(field)">
                  <app-material-field [matField]="field.getRawValue()"/>
                </app-selectable-form-field>
              }
            }
          </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="action-card">
      <mat-card-actions>
        <ng-content/>
      </mat-card-actions>
    </mat-card>
  </form>
  @if (selectedField() != null) {
    <app-edit-form-field class="supporting-pane__support flex-layout-container flex-layout-container__column"
                         [formFieldFormGroup]="selectedField()"
                         (remove)="removeSelectedField()"
                         (save)="updateField($event)"
                         (close)="selectedField.set(null)"/>
  }
</div>
